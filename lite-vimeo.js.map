{"version":3,"file":"lite-vimeo.js","sourceRoot":"","sources":["lite-vimeo.ts"],"names":[],"mappings":"AA+BA,MAAM,OAAO,cAAe,SAAQ,WAAW;IAa7C;QACE,KAAK,EAAE,CAAC;QAZF,iBAAY,GAAG,KAAK,CAAC;QAa3B,IAAI,CAAC,QAAQ,EAAE,CAAC;IAClB,CAAC;IAED,MAAM,KAAK,kBAAkB;QAC3B,OAAO,CAAC,SAAS,CAAC,CAAC;IACrB,CAAC;IAED,iBAAiB;QACf,IAAI,CAAC,gBAAgB,CAAC,aAAa,EAAE,cAAc,CAAC,eAAe,EAAE;YACnE,IAAI,EAAE,IAAI;SACX,CAAC,CAAC;QAEH,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;IACzD,CAAC;IAED,IAAI,OAAO;QACT,OAAO,kBAAkB,CAAC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC;IAChE,CAAC;IAED,IAAI,OAAO,CAAC,EAAU;QACpB,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;IACnC,CAAC;IAED,IAAI,UAAU;QACZ,OAAO,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,OAAO,CAAC;IACpD,CAAC;IAED,IAAI,UAAU,CAAC,KAAa;QAC1B,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;IACzC,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC;IAClD,CAAC;IAED,IAAI,SAAS,CAAC,IAAY;QACxB,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;IACvC,CAAC;IAED,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC;IAC5C,CAAC;IAED,IAAI,YAAY,CAAC,IAAY;QAC3B,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;IACnC,CAAC;IAED,IAAI,SAAS;QACX,OAAO,kBAAkB,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC,CAAC;IAClE,CAAC;IAED,IAAI,SAAS,CAAC,IAAY;QACxB,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;IACvC,CAAC;IAED,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;IACvC,CAAC;IAED,IAAI,QAAQ,CAAC,KAAc;QACzB,IAAI,KAAK,EAAE,CAAC;YACV,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;QACpC,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;QACnC,CAAC;IACH,CAAC;IAED,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;IACvC,CAAC;IAED,IAAI,QAAQ,CAAC,KAAc;QACzB,IAAI,KAAK,EAAE,CAAC;YACV,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;QAC5C,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;QACnC,CAAC;IACH,CAAC;IAMO,QAAQ;QACd,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC,CAAC;QACpD,SAAS,CAAC,SAAS,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAwHrB,CAAC;QACF,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC,aAAa,CAAiB,QAAQ,CAAE,CAAC;QACtE,IAAI,CAAC,SAAS,GAAG;YACf,QAAQ,EAAE,SAAS,CAAC,aAAa,CAAC,sBAAsB,CAAE;YAC1D,IAAI,EAAE,SAAS,CAAC,aAAa,CAAC,kBAAkB,CAAE;YAClD,IAAI,EAAE,SAAS,CAAC,aAAa,CAAC,kBAAkB,CAAE;SACnD,CAAC;QACF,IAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC,aAAa,CAC7C,cAAc,CACd,CAAC;IACL,CAAC;IAKO,cAAc;QAIpB,MAAM,UAAU,GACd,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,kBAAkB,CAAE,CAAC;QACrD,IAAI,UAAU,CAAC,aAAa,EAAE,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC5C,IAAI,CAAC,oBAAoB,EAAE,CAAC;QAC9B,CAAC;QAED,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAChC,YAAY,EACZ,GAAG,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,UAAU,EAAE,CACxC,CAAC;QACF,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;QAEpE,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAClB,IAAI,CAAC,wBAAwB,EAAE,CAAC;QAClC,CAAC;IACH,CAAC;IAQD,wBAAwB,CACtB,IAAY,EACZ,MAAe,EACf,MAAe;QAEf,QAAQ,IAAI,EAAE,CAAC;YACb,KAAK,SAAS,CAAC,CAAC,CAAC;gBACf,IAAI,MAAM,KAAK,MAAM,EAAE,CAAC;oBACtB,IAAI,CAAC,cAAc,EAAE,CAAC;oBAGtB,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE,CAAC;wBACzD,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;wBACnD,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,QAAQ,CAAE,CAAC,MAAM,EAAE,CAAC;oBAEpD,CAAC;gBACH,CAAC;gBACD,MAAM;YACR,CAAC;YACD;gBACE,MAAM;QACV,CAAC;IACH,CAAC;IAMO,SAAS;QACf,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;YAUvB,MAAM,MAAM,GAAG,IAAI,GAAG,CAAC,kCAAkC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;YACzE,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;YACpC,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACnC,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;YAC3C,CAAC;YAED,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;gBACnB,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/C,CAAC;YAED,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;gBACtB,MAAM,CAAC,IAAI,GAAG,KAAK,IAAI,CAAC,YAAY,EAAE,CAAC;YACzC,CAAC;YAED,MAAM,UAAU,GAAG;;;yBAGA,MAAM,aAAa,CAAC;YACvC,IAAI,CAAC,WAAW,CAAC,kBAAkB,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC;YAC7D,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YAChD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QAC3B,CAAC;IACH,CAAC;IAKO,KAAK,CAAC,oBAAoB;QAIhC,cAAc,CAAC,WAAW,CAAC,YAAY,EAAE,yBAAyB,CAAC,CAAC;QAGpE,MAAM,MAAM,GAAG,2DAA2D,IAAI,CAAC,OAAO,EAAE,CAAC;QAGzF,MAAM,WAAW,GAAG,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;QAIzD,MAAM,OAAO,GAAG,WAAW,CAAC,aAAa,CAAC;QAC1C,MAAM,KAAK,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAI3E,MAAM,aAAa,GACb,gCAAgC,KAAK,2BAA2B,CAAC;QACvE,MAAM,aAAa,GACb,gCAAgC,KAAK,0BAA0B,CAAC;QACtE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,aAAa,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,aAAa,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,GAAG,aAAa,CAAC;QAC5C,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,YAAY,CAClC,YAAY,EACZ,GAAG,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,UAAU,EAAE,CACxC,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,YAAY,CAClC,KAAK,EACL,GAAG,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,UAAU,EAAE,CACxC,CAAC;IACJ,CAAC;IAKO,wBAAwB;QAC9B,IACE,sBAAsB,IAAI,MAAM;YAChC,2BAA2B,IAAI,MAAM,EACrC,CAAC;YACD,MAAM,OAAO,GAAG;gBACd,IAAI,EAAE,IAAI;gBACV,UAAU,EAAE,KAAK;gBACjB,SAAS,EAAE,CAAC;aACb,CAAC;YAEF,MAAM,QAAQ,GAAG,IAAI,oBAAoB,CAAC,CAAC,OAAO,EAAE,QAAQ,EAAE,EAAE;gBAC9D,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;oBACtB,IAAI,KAAK,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;wBAC/C,cAAc,CAAC,eAAe,EAAE,CAAC;wBACjC,IAAI,CAAC,SAAS,EAAE,CAAC;wBACjB,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;oBAC3B,CAAC;gBACH,CAAC,CAAC,CAAC;YACL,CAAC,EAAE,OAAO,CAAC,CAAC;YAEZ,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACzB,CAAC;IACH,CAAC;IAUO,MAAM,CAAC,WAAW,CAAC,IAAY,EAAE,GAAW,EAAE,EAAW;QAC/D,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAChD,QAAQ,CAAC,GAAG,GAAG,IAAI,CAAC;QACpB,QAAQ,CAAC,IAAI,GAAG,GAAG,CAAC;QACpB,IAAI,EAAE,EAAE,CAAC;YACP,QAAQ,CAAC,EAAE,GAAG,EAAE,CAAC;QACnB,CAAC;QACD,QAAQ,CAAC,WAAW,GAAG,MAAM,CAAC;QAC9B,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IACjC,CAAC;IAYO,MAAM,CAAC,eAAe;QAC5B,IAAI,cAAc,CAAC,YAAY;YAAE,OAAO;QAExC,cAAc,CAAC,WAAW,CAAC,YAAY,EAAE,wBAAwB,CAAC,CAAC;QAGnE,cAAc,CAAC,WAAW,CAAC,YAAY,EAAE,0BAA0B,CAAC,CAAC;QAGrE,cAAc,CAAC,WAAW,CAAC,YAAY,EAAE,wBAAwB,CAAC,CAAC;QAEnE,cAAc,CAAC,YAAY,GAAG,IAAI,CAAC;IACrC,CAAC;;AAzCc,2BAAY,GAAG,KAAK,AAAR,CAAS;AA4CtC,cAAc,CAAC,MAAM,CAAC,YAAY,EAAE,cAAc,CAAC,CAAC","sourcesContent":["/**\r\n *\r\n * The shadowDom / Intersection Observer version of Paul's concept:\r\n * https://github.com/paulirish/lite-youtube-embed\r\n *\r\n * A lightweight Vimeo embed. Still should feel the same to the user, just\r\n * MUCH faster to initialize and paint.\r\n *\r\n * Thx to these as the inspiration\r\n *   https://storage.googleapis.com/amp-vs-non-amp/youtube-lazy.html\r\n *   https://autoplay-youtube-player.glitch.me/\r\n *\r\n * Once built it, I also found these (üëçüëç):\r\n *   https://github.com/ampproject/amphtml/blob/master/extensions/amp-youtube\r\n *   https://github.com/Daugilas/lazyYT https://github.com/vb/lazyframe\r\n */\r\n\r\n\r\n/*\r\n * Vimeo example embed markup:\r\n<iframe src=\"https://player.vimeo.com/video/364402896\"\r\n  width=\"640\" height=\"360\"\r\n  frameborder=\"0\"\r\n  allow=\"autoplay; fullscreen\" allowfullscreen>\r\n</iframe>\r\n<p><a href=\"https://vimeo.com/364402896\">\r\n  Alex Russell - The Mobile Web: MIA</a> from\r\n    <a href=\"https://vimeo.com/fronteers\">Fronteers</a>\r\n    on <a href=\"https://vimeo.com\">Vimeo</a>.\r\n</p>\r\n */\r\nexport class LiteVimeoEmbed extends HTMLElement {\r\n  shadowRoot!: ShadowRoot;\r\n  private iframeLoaded = false;\r\n  private domRefFrame!: HTMLDivElement;\r\n  private domRefImg!: {\r\n    fallback: HTMLImageElement;\r\n    webp: HTMLSourceElement;\r\n    jpeg: HTMLSourceElement;\r\n  };\r\n  private domRefPlayButton!: HTMLButtonElement;\r\n  // private static isPreconnected = false;\r\n  // private isIframeLoaded = false;\r\n\r\n  constructor() {\r\n    super();\r\n    this.setupDom();\r\n  }\r\n\r\n  static get observedAttributes(): string[] {\r\n    return ['videoid'];\r\n  }\r\n\r\n  connectedCallback(): void {\r\n    this.addEventListener('pointerover', LiteVimeoEmbed.warmConnections, {\r\n      once: true,\r\n    });\r\n\r\n    this.addEventListener('click', () => this.addIframe());\r\n  }\r\n\r\n  get videoId(): string {\r\n    return encodeURIComponent(this.getAttribute('videoid') || '');\r\n  }\r\n\r\n  set videoId(id: string) {\r\n    this.setAttribute('videoid', id);\r\n  }\r\n\r\n  get videoTitle(): string {\r\n    return this.getAttribute('videotitle') || 'Video';\r\n  }\r\n\r\n  set videoTitle(title: string) {\r\n    this.setAttribute('videotitle', title);\r\n  }\r\n\r\n  get videoPlay(): string {\r\n    return this.getAttribute('videoPlay') || 'Play';\r\n  }\r\n\r\n  set videoPlay(name: string) {\r\n    this.setAttribute('videoPlay', name);\r\n  }\r\n\r\n  get videoStartAt(): string {\r\n    return this.getAttribute('start') || '0s';\r\n  }\r\n\r\n  set videoStartAt(time: string) {\r\n    this.setAttribute('start', time);\r\n  }\r\n\r\n  get videoHash(): string {\r\n    return encodeURIComponent(this.getAttribute('videohash') || '');\r\n  }\r\n\r\n  set videoHash(hash: string) {\r\n    this.setAttribute('videohash', hash);\r\n  }\r\n\r\n  get autoLoad(): boolean {\r\n    return this.hasAttribute('autoload');\r\n  }\r\n\r\n  set autoLoad(value: boolean) {\r\n    if (value) {\r\n      this.setAttribute('autoload', '');\r\n    } else {\r\n      this.removeAttribute('autoload');\r\n    }\r\n  }\r\n\r\n  get autoPlay(): boolean {\r\n    return this.hasAttribute('autoplay');\r\n  }\r\n\r\n  set autoPlay(value: boolean) {\r\n    if (value) {\r\n      this.setAttribute('autoplay', 'autoplay');\r\n    } else {\r\n      this.removeAttribute('autoplay');\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Define our shadowDOM for the component\r\n   */\r\n  private setupDom(): void {\r\n    const shadowDom = this.attachShadow({mode: 'open'});\r\n    shadowDom.innerHTML = `\r\n      <style>\r\n        :host {\r\n          --aspect-ratio: var(--lite-vimeo-aspect-ratio, 16 / 9);\r\n          --aspect-ratio-short: var(--lite-vimeo-aspect-ratio-short, 9 / 16); \r\n          --frame-shadow-visible: var(--lite-vimeo-frame-shadow-visible, yes);     \r\n          contain: content;\r\n          display: block;\r\n          position: relative;\r\n          width: 100%;\r\n          padding-bottom: calc(100% / (16 / 9));\r\n        }\r\n\r\n        #frame, #fallbackPlaceholder, iframe {\r\n          position: absolute;\r\n          width: 100%;\r\n          height: 100%;\r\n          left: 0;\r\n          top: 0;\r\n        }\r\n\r\n        #frame {\r\n          cursor: pointer;\r\n        }\r\n\r\n        #fallbackPlaceholder, slot[name=image]::slotted(*) {\r\n          object-fit: cover;\r\n          width: 100%;\r\n        }\r\n\r\n        @container style(--frame-shadow-visible: yes) {\r\n          #frame::before {\r\n            content: '';\r\n            display: block;\r\n            position: absolute;\r\n            top: 0;\r\n            background-image: linear-gradient(180deg, #111 -20%, transparent 90%);\r\n            height: 60px;\r\n            width: 100%;\r\n            z-index: 1;\r\n          }\r\n        }        \r\n\r\n        #frame::before {\r\n          content: '';\r\n          display: block;\r\n          position: absolute;\r\n          top: 0;\r\n          background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAADGCAYAAAAT+OqFAAAAdklEQVQoz42QQQ7AIAgEF/T/D+kbq/RWAlnQyyazA4aoAB4FsBSA/bFjuF1EOL7VbrIrBuusmrt4ZZORfb6ehbWdnRHEIiITaEUKa5EJqUakRSaEYBJSCY2dEstQY7AuxahwXFrvZmWl2rh4JZ07z9dLtesfNj5q0FU3A5ObbwAAAABJRU5ErkJggg==);\r\n          background-position: top;\r\n          background-repeat: repeat-x;\r\n          height: 60px;\r\n          padding-bottom: 50px;\r\n          width: 100%;\r\n          transition: all 0.2s cubic-bezier(0, 0, 0.2, 1);\r\n          z-index: 1;\r\n        }\r\n        /* play button */\r\n        .lvo-playbtn {\r\n          width: 70px;\r\n          height: 46px;\r\n          background-color: #212121;\r\n          z-index: 1;\r\n          opacity: 0.8;\r\n          border-radius: 10%;\r\n          transition: all 0.2s cubic-bezier(0, 0, 0.2, 1);\r\n          border: 0;\r\n          cursor: pointer;\r\n        }\r\n        #frame:hover .lvo-playbtn {\r\n          background-color: rgb(98, 175, 237);\r\n          opacity: 1;\r\n        }\r\n        /* play button triangle */\r\n        .lvo-playbtn:before {\r\n          content: '';\r\n          border-style: solid;\r\n          border-width: 11px 0 11px 19px;\r\n          border-color: transparent transparent transparent #fff;\r\n        }\r\n        .lvo-playbtn,\r\n        .lvo-playbtn:before {\r\n          position: absolute;\r\n          top: 50%;\r\n          left: 50%;\r\n          transform: translate3d(-50%, -50%, 0);\r\n        }\r\n\r\n        /* Post-click styles */\r\n        .lvo-activated {\r\n          cursor: unset;\r\n        }\r\n        #frame picture {\r\n          transition: opacity 0.2s cubic-bezier(0, 0, 0.2, 1);\r\n          opacity: 1;\r\n        }\r\n        #frame.lvo-activated picture {\r\n          opacity: 0;\r\n        }\r\n\r\n        #frame.lvo-activated::before,\r\n        .lvo-activated .lvo-playbtn {\r\n          display: none;\r\n        }\r\n      </style>\r\n      <div id=\"frame\">\r\n        <picture>\r\n          <slot name=\"image\">\r\n            <source id=\"webpPlaceholder\" type=\"image/webp\">\r\n            <source id=\"jpegPlaceholder\" type=\"image/jpeg\">\r\n            <img id=\"fallbackPlaceholder\"\r\n                referrerpolicy=\"origin\"\r\n                width=\"1100\"\r\n                height=\"619\"\r\n                decoding=\"async\"\r\n                loading=\"lazy\">\r\n          </slot>\r\n        </picture>\r\n        <button class=\"lvo-playbtn\"></button>\r\n      </div>\r\n    `;\r\n    this.domRefFrame = shadowDom.querySelector<HTMLDivElement>('#frame')!;\r\n    this.domRefImg = {\r\n      fallback: shadowDom.querySelector('#fallbackPlaceholder')!,\r\n      webp: shadowDom.querySelector('#webpPlaceholder')!,\r\n      jpeg: shadowDom.querySelector('#jpegPlaceholder')!,\r\n    };\r\n    this.domRefPlayButton = shadowDom.querySelector<HTMLButtonElement>(\r\n      '.lvo-playbtn',\r\n    )!;\r\n  }\r\n\r\n  /**\r\n   * Parse our attributes and fire up some placeholders\r\n   */\r\n  private setupComponent(): void {\r\n    // If the named slot is not empty, then we save the network requests and\r\n    // don't fire up the selector; we use assignedNodes() since we're using\r\n    // default slot elements for the picture\r\n    const hasImgSlot: HTMLSlotElement =\r\n      this.shadowRoot.querySelector('slot[name=image]')!;\r\n    if (hasImgSlot.assignedNodes().length === 0) {\r\n      this.initImagePlaceholder();\r\n    }\r\n\r\n    this.domRefPlayButton.setAttribute(\r\n      'aria-label',\r\n      `${this.videoPlay}: ${this.videoTitle}`,\r\n    );\r\n    this.setAttribute('title', `${this.videoPlay}: ${this.videoTitle}`);\r\n\r\n    if (this.autoLoad) {\r\n      this.initIntersectionObserver();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lifecycle method that we use to listen for attribute changes to period\r\n   * @param {*} name\r\n   * @param {*} oldVal\r\n   * @param {*} newVal\r\n   */\r\n  attributeChangedCallback(\r\n    name: string,\r\n    oldVal: unknown,\r\n    newVal: unknown,\r\n  ): void {\r\n    switch (name) {\r\n      case 'videoid': {\r\n        if (oldVal !== newVal) {\r\n          this.setupComponent();\r\n\r\n          // if we have a previous iframe, remove it and the activated class\r\n          if (this.domRefFrame.classList.contains('lvo-activated')) {\r\n            this.domRefFrame.classList.remove('lvo-activated');\r\n            this.shadowRoot.querySelector('iframe')!.remove();\r\n            // this.isIframeLoaded = false;\r\n          }\r\n        }\r\n        break;\r\n      }\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Inject the iframe into the component body\r\n   */\r\n  private addIframe(): void {\r\n    if (!this.iframeLoaded) {\r\n      /**\r\n       * Vimeo example embed markup:\r\n       *\r\n       *  <iframe src=\"https://player.vimeo.com/video/364402896#t=1m3s\"\r\n       *    width=\"640\" height=\"360\"\r\n       *    frameborder=\"0\"\r\n       *    allow=\"autoplay; fullscreen\" allowfullscreen>\r\n       *  </iframe>\r\n       */\r\n      const srcUrl = new URL(`https://player.vimeo.com/video/${this.videoId}`);\r\n      srcUrl.searchParams.set('dnt', '1');\r\n      if (this.autoLoad && this.autoPlay) {\r\n        srcUrl.searchParams.set('autoplay', '1');\r\n      }\r\n\r\n      if (this.videoHash) {\r\n        srcUrl.searchParams.set('h', this.videoHash);\r\n      }\r\n\r\n      if (this.videoStartAt) {\r\n        srcUrl.hash = `t=${this.videoStartAt}`;\r\n      }\r\n\r\n      const iframeHTML = `\r\n<iframe frameborder=\"0\"\r\n  allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\r\n  allowfullscreen src=\"${srcUrl}\"></iframe>`;\r\n      this.domRefFrame.insertAdjacentHTML('beforeend', iframeHTML);\r\n      this.domRefFrame.classList.add('lvo-activated');\r\n      this.iframeLoaded = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup the placeholder image for the component\r\n   */\r\n  private async initImagePlaceholder(): Promise<any> {\r\n    // TODO(slightlyoff): TODO: cache API responses\r\n\r\n    // we don't know which image type to preload, so warm the connection\r\n    LiteVimeoEmbed.addPrefetch('preconnect', 'https://i.vimeocdn.com/');\r\n\r\n    // Hack to use the oEmbed API endpoint now that v2 is shut down\r\n    const apiUrl = `https://vimeo.com/api/oembed.json?url=https://vimeo.com/${this.videoId}`;\r\n\r\n    // Now fetch the JSON that locates our placeholder from vimeo's JSON API\r\n    const apiResponse = (await (await fetch(apiUrl)).json());\r\n\r\n    // Extract the image id, e.g. 819916979, from a URL like:\r\n    // thumbnail_url: \"https://i.vimeocdn.com/video/819916979-2d10b14e76f623b8efd8aaabef739468f206086f262fddb115b76245bdcc9813-d_295x166?region=us\"\r\n    const tnLarge = apiResponse.thumbnail_url;\r\n    const imgId = (tnLarge.substr(tnLarge.lastIndexOf(\"/\") + 1)).split(\"_\")[0];\r\n\r\n    // const posterUrlWebp =\r\n    //    `https://i.ytimg.com/vi_webp/${this.videoId}/hqdefault.webp`;\r\n    const posterUrlWebp =\r\n          `https://i.vimeocdn.com/video/${imgId}.webp?mw=1100&mh=619&q=70`;\r\n    const posterUrlJpeg =\r\n          `https://i.vimeocdn.com/video/${imgId}.jpg?mw=1100&mh=619&q=70`;\r\n    this.domRefImg.webp.srcset = posterUrlWebp;\r\n    this.domRefImg.jpeg.srcset = posterUrlJpeg;\r\n    this.domRefImg.fallback.src = posterUrlJpeg;\r\n    this.domRefImg.fallback.setAttribute(\r\n      'aria-label',\r\n      `${this.videoPlay}: ${this.videoTitle}`,\r\n    );\r\n    this.domRefImg.fallback.setAttribute(\r\n      'alt',\r\n      `${this.videoPlay}: ${this.videoTitle}`,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Setup the Intersection Observer to load the iframe when scrolled into view\r\n   */\r\n  private initIntersectionObserver(): void {\r\n    if (\r\n      'IntersectionObserver' in window &&\r\n      'IntersectionObserverEntry' in window\r\n    ) {\r\n      const options = {\r\n        root: null,\r\n        rootMargin: '0px',\r\n        threshold: 0,\r\n      };\r\n\r\n      const observer = new IntersectionObserver((entries, observer) => {\r\n        entries.forEach(entry => {\r\n          if (entry.isIntersecting && !this.iframeLoaded) {\r\n            LiteVimeoEmbed.warmConnections();\r\n            this.addIframe();\r\n            observer.unobserve(this);\r\n          }\r\n        });\r\n      }, options);\r\n\r\n      observer.observe(this);\r\n    }\r\n  }\r\n\r\n  private static preconnected = false;\r\n\r\n  /**\r\n   * Add a <link rel={preload | preconnect} ...> to the head\r\n   * @param {*} kind\r\n   * @param {*} url\r\n   * @param {*} as\r\n   */\r\n  private static addPrefetch(kind: string, url: string, as?: string): void {\r\n    const linkElem = document.createElement('link');\r\n    linkElem.rel = kind;\r\n    linkElem.href = url;\r\n    if (as) {\r\n      linkElem.as = as;\r\n    }\r\n    linkElem.crossOrigin = 'true';\r\n    document.head.append(linkElem);\r\n  }\r\n\r\n  /**\r\n   * Begin preconnecting to warm up the iframe load Since the embed's netwok\r\n   * requests load within its iframe, preload/prefetch'ing them outside the\r\n   * iframe will only cause double-downloads. So, the best we can do is warm up\r\n   * a few connections to origins that are in the critical path.\r\n   *\r\n   * Maybe `<link rel=preload as=document>` would work, but it's unsupported:\r\n   * http://crbug.com/593267 But TBH, I don't think it'll happen soon with Site\r\n   * Isolation and split caches adding serious complexity.\r\n   */\r\n  private static warmConnections(): void {\r\n    if (LiteVimeoEmbed.preconnected) return;\r\n    // Host that Vimeo uses to serve JS needed by player\r\n    LiteVimeoEmbed.addPrefetch('preconnect', 'https://f.vimeocdn.com');\r\n\r\n    // The iframe document comes from player.vimeo.com\r\n    LiteVimeoEmbed.addPrefetch('preconnect', 'https://player.vimeo.com');\r\n\r\n    // Image for placeholder comes from i.vimeocdn.com\r\n    LiteVimeoEmbed.addPrefetch('preconnect', 'https://i.vimeocdn.com');\r\n\r\n    LiteVimeoEmbed.preconnected = true;\r\n  }\r\n}\r\n// Register custom element\r\ncustomElements.define('lite-vimeo', LiteVimeoEmbed);\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'lite-vimeo': LiteVimeoEmbed;\r\n  }\r\n}\r\n"]}